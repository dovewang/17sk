/*
Copyright 2012, KISS UI Library v0.7.1
MIT Licensed
build time: Jun 1 14:13
*/(function(e){e.Jcrop=function(m,r){function g(a){return parseInt(a,10)+"px"}function C(a){a=e(a).offset();return[a.left,a.top]}function v(a){return[a.pageX-H[0],a.pageY-H[1]]}function A(b){"object"!=typeof b&&(b={});a=e.extend(a,b);e.each(["onChange","onSelect","onRelease","onDblClick"],function(b,p){"function"!=typeof a[p]&&(a[p]=function(){})})}function da(a,d){H=C(j);z.setCursor("move"===a?a:a+"-resize");if("move"===a)return z.activateHandlers(pa(d),X);var p=s.getFixed(),e=ea(a),c=s.getCorner(ea(e));
s.setPressed(s.getCorner(e));s.setCurrent(c);z.activateHandlers(qa(a,p),X)}function qa(b,d){return function(p){if(a.aspectRatio)switch(b){case "e":p[1]=d.y+1;break;case "w":p[1]=d.y+1;break;case "n":p[0]=d.x+1;break;case "s":p[0]=d.x+1}else switch(b){case "e":p[1]=d.y2;break;case "w":p[1]=d.y2;break;case "n":p[0]=d.x2;break;case "s":p[0]=d.x2}s.setCurrent(p);l.update()}}function pa(a){var d=a;return Y.watchKeys(),function(a){s.moveOffset([a[0]-d[0],a[1]-d[1]]);d=a;l.update()}}function ea(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function fa(b){return function(d){return a.disabled?!1:"move"===b&&!a.allowMove?!1:(H=C(j),I=!0,da(b,v(d)),d.stopPropagation(),d.preventDefault(),!1)}}function ga(a,d,p){var e=a.width(),c=a.height();e>d&&0<d&&(e=d,c=d/a.width()*a.height());c>p&&0<p&&(c=p,e=p/a.height()*a.width());t=a.width()/e;u=a.height()/c;a.width(e).height(c)}function N(a){return{x:parseInt(a.x*
t,10),y:parseInt(a.y*u,10),x2:parseInt(a.x2*t,10),y2:parseInt(a.y2*u,10),w:parseInt(a.w*t,10),h:parseInt(a.h*u,10)}}function X(){var b=s.getFixed();b.w>a.minSelect[0]&&b.h>a.minSelect[1]?(l.enableHandles(),l.done()):l.release();z.setCursor(a.allowSelect?"crosshair":"default")}function ha(b){if(a.disabled||!a.allowSelect)return!1;I=!0;H=C(j);l.disableHandles();z.setCursor("crosshair");var d=v(b);return s.setPressed(d),l.update(),z.activateHandlers(ra,X),Y.watchKeys(),b.stopPropagation(),b.preventDefault(),
!1}function ra(a){s.setCurrent(a);l.update()}function ia(){var b=e("<div></div>").addClass(a.baseClass+"-tracker");return e.browser.msie&&b.css({opacity:0,backgroundColor:"white"}),b}function ja(b){ka([parseInt(b[0],10)/t,parseInt(b[1],10)/u,parseInt(b[2],10)/t,parseInt(b[3],10)/u]);a.onSelect.call(w,N(s.getFixed()));l.enableHandles()}function ka(a){s.setPressed([a[0],a[1]]);s.setCurrent([a[2],a[3]]);l.update()}function la(){a.disabled=!0;l.disableHandles();l.setCursor("default");z.setCursor("default")}
function ma(){a.disabled=!1;Z()}function $(b,d,p){d=d||a.bgColor;a.bgFade&&e.fx.step.hasOwnProperty("backgroundColor")&&a.fadeTime&&!p?b.animate({backgroundColor:d},{queue:!1,duration:a.fadeTime}):b.css("backgroundColor",d)}function Z(b){a.allowResize?b?l.enableOnly():l.enableHandles():l.disableHandles();z.setCursor(a.allowSelect?"crosshair":"default");l.setCursor(a.allowMove?"move":"default");a.hasOwnProperty("trueSize")&&(t=a.trueSize[0]/q,u=a.trueSize[1]/n);a.hasOwnProperty("setSelect")&&(ja(a.setSelect),
l.done(),delete a.setSelect);D.refresh();a.bgColor!=na&&($(a.shade?D.getShades():B,a.shade?a.shadeColor||a.bgColor:a.bgColor),na=a.bgColor);O!=a.bgOpacity&&(O=a.bgOpacity,a.shade?D.refresh():l.setBgOpacity(O));P=a.maxSize[0]||0;Q=a.maxSize[1]||0;R=a.minSize[0]||0;S=a.minSize[1]||0;a.hasOwnProperty("outerImage")&&(j.attr("src",a.outerImage),delete a.outerImage);l.refresh()}var a=e.extend({},e.Jcrop.defaults),H,aa=!1;e.browser.msie&&"6"===e.browser.version.split(".")[0]&&(aa=!0);"object"!=typeof m&&
(m=e(m)[0]);"object"!=typeof r&&(r={});A(r);var ba={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},o=e(m),oa=!0;if("IMG"==m.tagName){if(0!=o[0].width&&0!=o[0].height)o.width(o[0].width),o.height(o[0].height);else{var ca=new Image;ca.src=o[0].src;o.width(ca.width);o.height(ca.height)}var j=o.clone().removeAttr("id").css(ba).show();j.width(o.width());j.height(o.height());o.after(j).hide()}else j=o.css(ba).show(),oa=!1,null===a.shade&&(a.shade=!0);ga(j,a.boxWidth,
a.boxHeight);var q=j.width(),n=j.height(),B=e("<div />").width(q).height(n).addClass(a.baseClass+"-holder").css({position:"relative",backgroundColor:a.bgColor}).insertAfter(o).append(j);a.addClass&&B.addClass(a.addClass);var E=e("<div />"),U=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),J=e("<div />").width("100%").height("100%").css("zIndex",320),K=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var b=s.getFixed();a.onDblClick.call(w,
b)}).insertBefore(j).append(U,J);oa&&(E=e("<img />").attr("src",j.attr("src")).css(ba).width(q).height(n),U.append(E));aa&&K.css({overflowY:"hidden"});var L=a.boundary,F=ia().width(q+2*L).height(n+2*L).css({position:"absolute",top:g(-L),left:g(-L),zIndex:290}).mousedown(ha),na=a.bgColor,O=a.bgOpacity,P,Q,R,S,t,u,I,sa;H=C(j);var G=function(){function b(){var a={},b=["touchstart","touchmove","touchend"],e=document.createElement("div"),c;try{for(c=0;c<b.length;c++){var f=b[c],f="on"+f,h=f in e;h||(e.setAttribute(f,
"return;"),h="function"==typeof e[f]);a[b[c]]=h}return a.touchstart&&a.touchend&&a.touchmove}catch(k){return!1}}return{createDragger:function(b){return function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,a.disabled?!1:"move"===b&&!a.allowMove?!1:(I=!0,da(b,v(e)),e.stopPropagation(),e.preventDefault(),!1)}},newSelection:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,ha(a)},
isSupported:b,support:!0===a.touchSupport||!1===a.touchSupport?a.touchSupport:b()}}(),s=function(){function e(){if(!a.aspectRatio){var i=h-c,b=k-f,d;return P&&Math.abs(i)>P&&(h=0<i?c+P:c-P),Q&&Math.abs(b)>Q&&(k=0<b?f+Q:f-Q),S/u&&Math.abs(b)<S/u&&(k=0<b?f+S/u:f-S/u),R/t&&Math.abs(i)<R/t&&(h=0<i?c+R/t:c-R/t),0>c&&(h-=c,c-=c),0>f&&(k-=f,f-=f),0>h&&(c-=h,h-=h),0>k&&(f-=k,k-=k),h>q&&(d=h-q,c-=d,h-=d),k>n&&(d=k-n,f-=d,k-=d),c>q&&(d=c-n,k-=d,f-=d),f>n&&(d=f-n,k-=d,f-=d),l(p(c,f,h,k))}d=a.aspectRatio;var g=
a.minSize[0]/t,M=a.maxSize[0]/t,V=h-c,W=k-f,j=Math.abs(V),s=Math.abs(W),o,m;return 0===M&&(M=10*q),j/s<d?(b=k,o=s*d,i=0>V?c-o:o+c,0>i?(i=0,m=Math.abs((i-c)/d),b=0>W?f-m:m+f):i>q&&(i=q,m=Math.abs((i-c)/d),b=0>W?f-m:m+f)):(i=h,m=j/d,b=0>W?f-m:f+m,0>b?(b=0,o=Math.abs((b-f)*d),i=0>V?c-o:o+c):b>n&&(b=n,o=Math.abs(b-f)*d,i=0>V?c-o:o+c)),i>c?(i-c<g?i=c+g:i-c>M&&(i=c+M),b>f?b=f+(i-c)/d:b=f-(i-c)/d):i<c&&(c-i<g?i=c-g:c-i>M&&(i=c-M),b>f?b=f+(c-i)/d:b=f-(c-i)/d),0>i?(c-=i,i=0):i>q&&(c-=i-q,i=q),0>b?(f-=b,b=
0):b>n&&(f-=b-n,b=n),l(p(c,f,i,b))}function d(a){return 0>a[0]&&(a[0]=0),0>a[1]&&(a[1]=0),a[0]>q&&(a[0]=q),a[1]>n&&(a[1]=n),[a[0],a[1]]}function p(a,b,c,d){var f=c,e=b,k=d;return c<a&&(f=a),d<b&&(e=d,k=b),[Math.round(a),Math.round(e),Math.round(f),Math.round(k)]}function l(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var c=0,f=0,h=0,k=0,g,j;return{flipCoords:p,setPressed:function(a){a=d(a);h=c=a[0];k=f=a[1]},setCurrent:function(a){a=d(a);g=a[0]-h;j=a[1]-k;h=a[0];k=a[1]},getOffset:function(){return[g,
j]},moveOffset:function(a){var b=a[0],a=a[1];0>c+b&&(b-=b+c);0>f+a&&(a-=a+f);n<k+a&&(a+=n-(k+a));q<h+b&&(b+=q-(h+b));c+=b;h+=b;f+=a;k+=a},getCorner:function(a){var c=e();switch(a){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:e}}(),D=function(){var b,d,p,o;function c(){return f(s.getFixed())}function f(a){p.css({left:g(a.x),width:g(a.w),height:g(a.y)});o.css({top:g(a.y2),left:g(a.x),width:g(a.w),height:g(n-a.y2)});d.css({left:g(a.x2),
width:g(q-a.x2)});b.css({width:g(a.x)})}function h(){return e("<div />").css({position:"absolute",backgroundColor:a.shadeColor||a.bgColor}).appendTo(r)}function k(){T||(T=!0,r.insertBefore(j),c(),l.setBgOpacity(1,0,1),E.hide(),m(a.shadeColor||a.bgColor,1),l.isAwake()?i(a.bgOpacity,1):i(1,1))}function m(a,b){$(u(),a,b)}function t(){T&&(r.remove(),E.show(),T=!1,l.isAwake()?l.setBgOpacity(a.bgOpacity,1,1):(l.setBgOpacity(1,1,1),l.disableHandles()),$(B,0,1))}function i(b,c){T&&(a.bgFade&&!c?r.animate({opacity:1-
b},{queue:!1,duration:a.fadeTime}):r.css({opacity:1-b}))}function u(){return r.children()}var T=!1,r=e("<div />").css({position:"absolute",zIndex:240,opacity:0});p=h();b=h().height(n);d=h().height(n);o=h();return{update:c,updateRaw:f,getShades:u,setBgColor:m,enable:k,disable:t,resize:function(a,c){b.css({height:g(c)});d.css({height:g(c)})},refresh:function(){a.shade?k():t();l.isAwake()&&i(a.bgOpacity)},opacity:i}}(),l=function(){function b(a,b){var c=e("<div />").mousedown(fa(a)).css({cursor:a+"-resize",
position:"absolute",zIndex:b}).addClass("ord-"+a);return G.support&&c.bind("touchstart.jcrop",G.createDragger(a)),J.append(c),c}function d(a){var c;for(c=0;c<a.length;c++)b(a[c],q++).addClass("jcrop-dragbar")}function p(b){var c,d;for(d=0;d<b.length;d++){switch(b[d]){case "n":c="hline";break;case "s":c="hline bottom";break;case "e":c="vline right";break;case "w":c="vline"}var f=c,f=e("<div />").css({position:"absolute",opacity:a.borderOpacity}).addClass(a.baseClass+"-"+f);U.append(f)}}function l(c){var d;
for(d=0;d<c.length;d++){var f=a.handleSize;b(c[d],q++).css({opacity:a.handleOpacity}).width(f).height(f).addClass(a.baseClass+"-handle")}}function c(){var a=s.getFixed();s.setPressed([a.x,a.y]);s.setCurrent([a.x2,a.y2]);f()}function f(a){if(m)return h(a)}function h(b){var c=s.getFixed(),d=c.h;K.width(c.w).height(d);var d=c.x,f=c.y;a.shade||E.css({top:g(-f),left:g(-d)});K.css({top:g(f),left:g(d)});a.shade&&D.updateRaw(c);m||(K.show(),a.shade?D.opacity(O):k(O,!0),m=!0);b?a.onSelect.call(w,N(c)):a.onChange.call(w,
N(c))}function k(c,b,d){if(m||b)a.bgFade&&!d?j.animate({opacity:c},{queue:!1,duration:a.fadeTime}):j.css("opacity",c)}function o(){r=!0;if(a.allowResize)return J.show(),!0}function n(){r=!1;J.hide()}function i(a){void 0===a?n():o()}var m,q=370,r=!1;a.dragEdges&&e.isArray(a.createDragbars)&&d(a.createDragbars);e.isArray(a.createHandles)&&l(a.createHandles);a.drawBorders&&e.isArray(a.createBorders)&&p(a.createBorders);e(document).bind("touchstart.jcrop-ios",function(a){e(a.currentTarget).hasClass("jcrop-tracker")&&
a.stopPropagation()});var t=ia().mousedown(fa("move")).css({cursor:"move",position:"absolute",zIndex:360});return G.support&&t.bind("touchstart.jcrop",G.createDragger("move")),U.append(t),n(),{updateVisible:f,update:h,release:function(){n();K.hide();a.shade?D.opacity(1):k(1);m=!1;a.onRelease.call(w)},refresh:c,isAwake:function(){return m},setCursor:function(a){t.css("cursor",a)},enableHandles:o,enableOnly:function(){r=!0},showHandles:function(){r&&J.show()},disableHandles:n,animMode:i,setBgOpacity:k,
done:function(){i(!1);c()}}}(),z=function(){function b(a){return c(v(a)),!1}function d(b){b.preventDefault();b.stopPropagation();I&&(I=!1,f(v(b)),l.isAwake()&&a.onSelect.call(w,N(s.getFixed())),F.css({zIndex:290}),e(document).unbind(".jcrop"),c=function(){},f=function(){});return!1}function p(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,b(a)}function g(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,
d(a)}var c=function(){},f=function(){},h=a.trackDocument;return h||F.mousemove(b).mouseup(d).mouseout(d),j.before(F),{activateHandlers:function(a,l){I=!0;c=a;f=l;F.css({zIndex:450});G.support&&e(document).bind("touchmove.jcrop",p).bind("touchend.jcrop",g);h&&e(document).bind("mousemove.jcrop",b).bind("mouseup.jcrop",d);return!1},setCursor:function(a){F.css("cursor",a)}}}(),Y=function(){function b(){g.hide()}function d(b,c,d){a.allowMove&&(s.moveOffset([c,d]),l.updateVisible(!0));b.preventDefault();
b.stopPropagation()}function p(b){if(b.ctrlKey||b.metaKey)return!0;var c=(sa=b.shiftKey?!0:!1)?10:1;switch(b.keyCode){case 37:d(b,-c,0);break;case 39:d(b,c,0);break;case 38:d(b,0,-c);break;case 40:d(b,0,c);break;case 27:a.allowSelect&&l.release();break;case 9:return!0}return!1}var g=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),c=e("<div />").css({position:"absolute",overflow:"hidden"}).append(g);return a.keySupport&&(g.keydown(p).blur(b),aa||!a.fixedSupport?(g.css({position:"absolute",
left:"-20px"}),c.append(g).insertBefore(j)):g.insertBefore(j)),{watchKeys:function(){a.keySupport&&(g.show(),g.focus())}}}();G.support&&F.bind("touchstart.jcrop",G.newSelection);J.hide();Z(!0);var w={setImage:function(b,d){l.release();la();var e=new Image;e.onload=function(){var g=e.height,c=a.boxWidth,f=a.boxHeight;j.width(e.width).height(g);j.attr("src",b);E.attr("src",b);ga(j,c,f);q=j.width();n=j.height();E.width(q).height(n);F.width(q+2*L).height(n+2*L);B.width(q).height(n);D.resize(q,n);ma();
"function"==typeof d&&d.call(w)};e.src=b},animateTo:function(b,d){var e=parseInt(b[0],10)/t,g=parseInt(b[1],10)/u,c=parseInt(b[2],10)/t,f=parseInt(b[3],10)/u,e=s.flipCoords(e,g,c,f),g=s.getFixed(),h=[g.x,g.y,g.x2,g.y2],k=a.animationDelay,m=e[0]-h[0],n=e[1]-h[1],i=e[2]-h[2],o=e[3]-h[3],j=0,q=a.swingSpeed;x=h[0];y=h[1];c=h[2];f=h[3];l.animMode(!0);var r=function(){return function(){j+=(100-j)/q;h[0]=x+j/100*m;h[1]=y+j/100*n;h[2]=c+j/100*i;h[3]=f+j/100*o;99.8<=j&&(j=100);100>j?(ka(h),window.setTimeout(r,
k)):(l.done(),"function"==typeof d&&d.call(w))}}();window.setTimeout(r,k)},setSelect:ja,setOptions:function(a){A(a);Z()},tellSelect:function(){return N(s.getFixed())},tellScaled:function(){return s.getFixed()},setClass:function(b){B.removeClass().addClass(a.baseClass+"-holder").addClass(b)},disable:la,enable:ma,cancel:function(){l.done();z.activateHandlers(null,null)},release:l.release,destroy:function(){B.remove();o.show();e(m).removeData("Jcrop")},focus:Y.watchKeys,getBounds:function(){return[q*
t,n*u]},getWidgetSize:function(){return[q,n]},getScaleFactor:function(){return[t,u]},ui:{holder:B,selection:K}};return e.browser.msie&&B.bind("selectstart",function(){return!1}),o.data("Jcrop",w),w};e.fn.Jcrop=function(m,r){var g;return this.each(function(){if(e(this).data("Jcrop")){if("api"===m)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(m)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"});g=e.Jcrop(this,m);e.isFunction(r)&&
r.call(g)}):(e(this).css({display:"block",visibility:"hidden"}),g=e.Jcrop(this,m),e.isFunction(r)&&r.call(g))}),this};e.Jcrop.Loader=function(m,r,g){function C(){A.complete?(v.unbind(".jcloader"),e.isFunction(r)&&r.call(A)):window.setTimeout(C,50)}var v=e(m),A=v[0];v.bind("load.jcloader",C).bind("error.jcloader",function(){v.unbind(".jcloader");e.isFunction(g)&&g.call(A)});A.complete&&e.isFunction(r)&&(v.unbind(".jcloader"),r.call(A))};e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,
trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,handleSize:7,aspectRatio:0,keySupport:!0,createHandles:"n,s,e,w,nw,ne,se,sw".split(","),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},
onDblClick:function(){},onRelease:function(){}}})(jQuery);
